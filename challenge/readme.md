# F1 Data Service

We want you to write an HTTP service which provides a REST API to get Formula 1 data
from a SQLite database.

You will need to create the database using the csv data files provided in the 'data'
directory.

## Tools

Your service must be based on the following tools:

- Python 3.8
- [FastAPI](https://fastapi.tiangolo.com).
- [Uvicorn](https://www.uvicorn.org) please use this as your web server (this is the default for FastAPI). You do not need to configure the web server, just run locally on port 500.
- [sqlalchemy](https://www.sqlalchemy.org) using SQLite as the underlying database.
- [alembic](https://alembic.sqlalchemy.org/en/latest/) for your database migrations and deployment.
- [pytest](https://docs.pytest.org/en/7.1.x/) for your unit tests. We would also
like to see test coverage measured with [pytest-cov](https://pytest-cov.readthedocs.io/en/latest/).

You may be unfamiliar with some or all of these packages and that's ok. The FastAPI
documentation is fantastic and will give you pretty much everything you need to get
these tools running together. Also, you can reach out for help at any time - this is
not an exam!

You are free to use any other Python packages that you feel are necessary to create
the service.

## The Service

We would like to make the following calls against your service:

### `/ping`

This is a simple health check that we can use to determine that the service is
running, and provides information about the application. The `"version"`
attribute in the response should match the version number in the `VERSION`
file. The return JSON should match the following structure:

```
{
  "name": "f1_data_service",
  "status": "ok",
  "version": "1.0.0"
}
```

### `/drivers/<driver_id>`

This route should return the driver details for the specified Driver ID. The return
JSON should match the following structure:

```
{
  "code": "HAM",
  "dob": "07/01/1985",
  "driver_id": 1,
  "forename": "Lewis",
  "nationality": "British",
  "number": 44,
  "surname": "Hamilton",
  "url": "http://example.com"
}
```

### `/race/<race_id>/results`

This route should return the finishing status for each driver in the specified race.
The return JSON should match the following structure ordered ascending according to
position:

```
{
  "constructor_id": 1,
  "driver_id": 1,
  "position": 1,
  "status": "Finished"
}
```

### `/race/<race_id>/laptimes?driver_id=<driver_1_id>&driver_id=<driver_2_id>`

This route is designed to allow the laptimes for a specified set of driver IDs to be
retrieved for a specific race. The driver IDs are to be provided through URL query
parameters. The return JSON should match the following structure with laptimes sorted
by lap number (ascending):

```
[
  {
    "driver_id: 1,
    "laptimes": [
      {
          "lap_number": 1,
          "seconds": 98.109
      }
    ]
  }
]
```

### Errors

When no data is found or the API call is invalid the service should respond with an
appropriate HTTP error:

- 404 Not Found error if something is not found (e.g. driver ID does not exist)
- 400 Bad Request error if the API call includes invalid data (e.g. providing the
driver ID as a string)
- 500 Internal Server error for all other errors

The client 40X errors should include a helpful description of the error cause.

## API documentation

One of the many great things about FastAPI is that you get automatic generation of
OpenAPI spec documentation which can be viewed in Swagger UI.

We use the Swagger UI heavily to test our APIs during development and so consumers of
our APIs understand what they will receive. As such, we put additional effort into
making sure that the autogenerated documentation is complete. You should ensure that
your documentation includes the applicable error responses for each route, and all
routes should have detailed descriptions, and summary strings.

You can find details of how to use the Swagger UI in the FastAPI documentation.

We will test your API using the Swagger UI.

## Data validation

The validation of user submitted data is a key factor in the resilience and
performance of your API. Please ensure that you validate all data coming into the API
using `pydantic` as described in the FastAPI documentation.

You should also use `pydantic` to validate and format the data you return from the
API. Your `pydantic` data schemas will also be a key part of the API documentation.

## Code quality

It is super important that your code is readable and well presented.

### Style and formatting

As a general framework, please follow the [Google Python style guide](https://google.github.io/styleguide/pyguide.html) (with particular attention on section 3, and 3.16.4). However, we favour a different toolset to Google.

For linting your code Google recommends using `pylint` but we prefer [flake8](https://flake8.pycqa.org/en/latest/) and [mypy](https://mypy.readthedocs.io/en/stable/).

For auto-formatting your code Google recommends `yapf` but we prefer [black](https://black.readthedocs.io/en/stable/).

To make life easier we recommend setting these up in your IDE so they are always
automatically running. Its also recommended to get these setup before you start
working on your code - they are super helpful!

### Type annotations

In Python, type annotations are optional details that make our code more explicit.
Unlike other languages, type annotations are not enforced and do not affect your
program at runtime. We use them purely to improve code readability and to show
intention.

A good introduction to type annotations in Python can be found [here](https://towardsdatascience.com/type-annotations-in-python-d90990b172dc).

Your code must be fully type annotated (`mypy` will help you with this).

### Docstrings

Documentation in Python is extremely important because of the dynamic nature of the
language. Python provides built-in support for attaching documentation to blocks of
code - docstrings!

We believe that every (public) function, class, method, and module should have a
docstring (private code blocks are optional but encouraged). We use docstrings for
several reasons:

- Code readability
- Auto-generation of HTML documentation (outside of scope for this project)
- Linking in with your IDE's interactive documentation viewer (i.e. you get to see
the docstrings when you type a function name with the first bracket).

Be sure to follow section 3.8 of the Google Python Style Guide for docstrings.

### Testing

We believe that code without tests is bad code! Please include unit tests for all of
your business logic and integration tests for your API endpoints. Please also check
your test coverage using `pytest-cov`.

## Outline process

- Create your database models
- Write a script to ingest the csv data into your database
- Write your API endpoints in the same order as they are defined in this document

## Submission

When you have completed the project please zip up all of your code and data files. We
would like you to provide some basic instructions for how we:

- Build and seed the database
- Start the web server and load the Swagger UI

## Help

Please ask for as much help as you need, this is not an exam, just an exercise
designed to familiarise you with working on REST APIs in Python.
